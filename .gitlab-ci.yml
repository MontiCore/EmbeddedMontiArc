# (c) https://github.com/MontiCore/monticore
stages:
  - build
  - test

TestBuildVAE:
  stage: build
  image: registry.git.rwth-aachen.de/monticore/embeddedmontiarc/generators/emadl2cpp/dockerimages/mxnet170:v0.0.1
  allow_failure: true
  script:
  - mv /mxnet/build/libmxnet.so /mxnet/build/libmxnet.a /usr/lib/
  - cd standard-vae/src/test/test_training
  - bash build.sh

TestBuildBetaVAE:
  stage: build
  image: registry.git.rwth-aachen.de/monticore/embeddedmontiarc/generators/emadl2cpp/dockerimages/mxnet170:v0.0.1
  allow_failure: true
  script:
  - mv /mxnet/build/libmxnet.so /mxnet/build/libmxnet.a /usr/lib/
  - cd beta-vae/src/test/test_training
  - bash build.sh

TestBuildCVAE:
  stage: build
  image: registry.git.rwth-aachen.de/monticore/embeddedmontiarc/generators/emadl2cpp/dockerimages/mxnet170:v0.0.1
  allow_failure: true
  script:
  - mv /mxnet/build/libmxnet.so /mxnet/build/libmxnet.a /usr/lib/
  - cd conditional-vae/src/test/test_training
  - bash build.sh

TestBuildVQVAE:
  stage: build
  image: registry.git.rwth-aachen.de/monticore/embeddedmontiarc/generators/emadl2cpp/dockerimages/mxnet170:v0.0.1
  allow_failure: true
  script:
  - mv /mxnet/build/libmxnet.so /mxnet/build/libmxnet.a /usr/lib/
  - cd vq-vae/src/test/test_training
  - bash build.sh

TestPretrainedVAE:
  stage: test
  image: registry.git.rwth-aachen.de/monticore/embeddedmontiarc/generators/emadl2cpp/dockerimages/mxnet170:v0.0.1
  allow_failure: true
  script:
    - mv /mxnet/build/libmxnet.so /mxnet/build/libmxnet.a /usr/lib/
    - cd standard-vae
    - cp -a pre-trained/model/vae.Encoder/. src/test/test_pre-trained/model/mnist.Encoder/
    - cp -a pre-trained/model/vae.Decoder/. src/test/test_pre-trained/model/mnist.Decoder/
    - cd src/test/test_pre-trained
    - bash cpp_compile.sh
    - bash test_digit_generation.sh

TestPretrainedBetaVAE:
  stage: test
  image: registry.git.rwth-aachen.de/monticore/embeddedmontiarc/generators/emadl2cpp/dockerimages/mxnet170:v0.0.1
  allow_failure: true
  script:
    - mv /mxnet/build/libmxnet.so /mxnet/build/libmxnet.a /usr/lib/
    - cd beta-vae
    - cp -a pre-trained/model/bvae.Encoder/. src/test/test_pre-trained/model/mnist.Encoder/
    - cp -a pre-trained/model/bvae.Decoder/. src/test/test_pre-trained/model/mnist.Decoder/
    - cd src/test/test_pre-trained
    - bash cpp_compile.sh
    - bash test_digit_generation.sh

TestPretrainedCVAE:
  stage: test
  image: registry.git.rwth-aachen.de/monticore/embeddedmontiarc/generators/emadl2cpp/dockerimages/mxnet170:v0.0.1
  allow_failure: true
  script:
    - mv /mxnet/build/libmxnet.so /mxnet/build/libmxnet.a /usr/lib/
    - cd conditional-vae
    - cp -a pre-trained/model/cvae.Encoder/. src/test/test_pre-trained/model/mnist.Encoder/
    - cp -a pre-trained/model/cvae.Decoder/. src/test/test_pre-trained/model/mnist.Decoder/
    - cd src/test/test_pre-trained
    - bash cpp_compile.sh
    - bash test_digit_generation.sh

TestPretrainedVQVAE:
  stage: test
  image: registry.git.rwth-aachen.de/monticore/embeddedmontiarc/generators/emadl2cpp/dockerimages/mxnet170:v0.0.1
  allow_failure: true
  script:
    - mv /mxnet/build/libmxnet.so /mxnet/build/libmxnet.a /usr/lib/
    - cd vq-vae
    - cp -a pre-trained/model/vqvae.Encoder/. src/test/test_pre-trained/model/mnist.Encoder/
    - cp -a pre-trained/model/vqvae.Decoder/. src/test/test_pre-trained/model/mnist.Decoder/
    - cd src/test/test_pre-trained
    - bash cpp_compile.sh
    - bash test_digit_generation.sh