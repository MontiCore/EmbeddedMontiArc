image: "engpablomartinez/nodejs-mvn-jdk-chrome"

variables:
  MAVEN_OPTS: "-Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn"

before_script:
  - apt-get update && apt-get install -y build-essential

stages:
  - install
  - deploy

install:
  stage: install
  script:
    - mvn -B clean install
  artifacts:
    reports:
      junit:
        - "*/*/*/target/surefire-reports/TEST-*.xml"
  except:
    - master

pages:
  stage: deploy
  script:
    - mvn -B clean install # We need to install first as the custom plugins need to be installed.
    - mvn -B deploy -DskipTests
  artifacts:
    paths:
      - "public"
  only:
    - master