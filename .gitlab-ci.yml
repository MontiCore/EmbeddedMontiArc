
stages:
- windows
- test
 
masterJobWindows:
  stage: windows
  script: 
#  - VsDevCmd.bat
  - echo %PATH%
  - cmake -h
  - cd pe-parse
  - "..\\docs\\build.bat"
  - msbuild build\pe-parse.sln /m /p:Configuration=Debug /p:Platform=x64
  - msbuild build\pe-parse.sln /m /p:Configuration=Release /p:Platform=x64
  - cd ..
  - cd unicorn
  - "..\\docs\\build.bat"
  - msbuild build\unicorn.sln /m /p:Configuration=Debug /p:Platform=x64
  - msbuild build\unicorn.sln /m /p:Configuration=Release /p:Platform=x64
  - cd ..
  - cd zydis
  - "..\\docs\\build.bat"
  - msbuild build\Zydis.sln /m /p:Configuration=Debug /p:Platform=x64
  - msbuild build\Zydis.sln /m /p:Configuration=Release /p:Platform=x64
  - cd ..
  - cd hardware_emulator
  - "..\\docs\\build.bat"
  - msbuild build\hardware-emulator.sln /m /p:Configuration=Debug /p:Platform=x64
  - msbuild build\hardware-emulator.sln /m /p:Configuration=Release /p:Platform=x64
  - cd ..
  tags:
  - Windows10
  only:
  - master
  artifacts:
    paths:
      - hardware_emulator/build/Debug/hardware-emulator-test.exe
      - hardware_emulator/bin/AutopilotModel.dll
      - hardware_emulator/bin/loaded_dll.dll
      - hardware_emulator/bin/SampleDLL.dll

test_windows:
  stage: test
  tags:
  - Windows10
  script:
    - copy "hardware_emulator\build\Debug\hardware-emulator-test.exe" "hardware_emulator\bin"
    - cd hardware_emulator\bin
    - hardware-emulator-test
  dependencies:
    - masterJobWindows
