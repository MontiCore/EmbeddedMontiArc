/**
 * ====
 *     ====
 *         ====
 *             ====
 *                 ====
 *                     ====
 *                         ====
 *                             ====
 *                                 ====
 *                                     ====
 *                                         ====
 *                                             ====
 *                                                 ====
 *                                                     ====
 *                                                         ====
 *                                                             ====
 *                                                                 ====
 *                                                                     ====
 *                                                                         ====
 *                                                                             ====
 *                                                                                 ====
 *                                                                                     ====
 *                                                                                         ====
 *                                                                                             ====
 *                                                                                                 ====
 *                                                                                                     ====
 *                                                                                                         ====
 *                                                                                                             ====
 *                                                                                                                 ******************************************************************************
 *                                                                                                                  MontiCAR Modeling Family, www.se-rwth.de
 *                                                                                                                  Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                                                                  All rights reserved.
 *
 *                                                                                                                  This project is free software; you can redistribute it and/or
 *                                                                                                                  modify it under the terms of the GNU Lesser General Public
 *                                                                                                                  License as published by the Free Software Foundation; either
 *                                                                                                                  version 3.0 of the License, or (at your option) any later version.
 *                                                                                                                  This library is distributed in the hope that it will be useful,
 *                                                                                                                  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                                                                  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                                                                  Lesser General Public License for more details.
 *
 *                                                                                                                  You should have received a copy of the GNU Lesser General Public
 *                                                                                                                  License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                                                                 *******************************************************************************
 *                                                                                                             ====
 *
 *                                                                                                             ******************************************************************************
 *                                                                                                              MontiCAR Modeling Family, www.se-rwth.de
 *                                                                                                              Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                                                              All rights reserved.
 *
 *                                                                                                              This project is free software; you can redistribute it and/or
 *                                                                                                              modify it under the terms of the GNU Lesser General Public
 *                                                                                                              License as published by the Free Software Foundation; either
 *                                                                                                              version 3.0 of the License, or (at your option) any later version.
 *                                                                                                              This library is distributed in the hope that it will be useful,
 *                                                                                                              but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                                                              MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                                                              Lesser General Public License for more details.
 *
 *                                                                                                              You should have received a copy of the GNU Lesser General Public
 *                                                                                                              License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                                                             *******************************************************************************
 *                                                                                                         ====
 *
 *                                                                                                         ******************************************************************************
 *                                                                                                          MontiCAR Modeling Family, www.se-rwth.de
 *                                                                                                          Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                                                          All rights reserved.
 *
 *                                                                                                          This project is free software; you can redistribute it and/or
 *                                                                                                          modify it under the terms of the GNU Lesser General Public
 *                                                                                                          License as published by the Free Software Foundation; either
 *                                                                                                          version 3.0 of the License, or (at your option) any later version.
 *                                                                                                          This library is distributed in the hope that it will be useful,
 *                                                                                                          but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                                                          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                                                          Lesser General Public License for more details.
 *
 *                                                                                                          You should have received a copy of the GNU Lesser General Public
 *                                                                                                          License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                                                         *******************************************************************************
 *                                                                                                     ====
 *
 *                                                                                                     ******************************************************************************
 *                                                                                                      MontiCAR Modeling Family, www.se-rwth.de
 *                                                                                                      Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                                                      All rights reserved.
 *
 *                                                                                                      This project is free software; you can redistribute it and/or
 *                                                                                                      modify it under the terms of the GNU Lesser General Public
 *                                                                                                      License as published by the Free Software Foundation; either
 *                                                                                                      version 3.0 of the License, or (at your option) any later version.
 *                                                                                                      This library is distributed in the hope that it will be useful,
 *                                                                                                      but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                                                      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                                                      Lesser General Public License for more details.
 *
 *                                                                                                      You should have received a copy of the GNU Lesser General Public
 *                                                                                                      License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                                                     *******************************************************************************
 *                                                                                                 ====
 *
 *                                                                                                 ******************************************************************************
 *                                                                                                  MontiCAR Modeling Family, www.se-rwth.de
 *                                                                                                  Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                                                  All rights reserved.
 *
 *                                                                                                  This project is free software; you can redistribute it and/or
 *                                                                                                  modify it under the terms of the GNU Lesser General Public
 *                                                                                                  License as published by the Free Software Foundation; either
 *                                                                                                  version 3.0 of the License, or (at your option) any later version.
 *                                                                                                  This library is distributed in the hope that it will be useful,
 *                                                                                                  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                                                  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                                                  Lesser General Public License for more details.
 *
 *                                                                                                  You should have received a copy of the GNU Lesser General Public
 *                                                                                                  License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                                                 *******************************************************************************
 *                                                                                             ====
 *
 *                                                                                             ******************************************************************************
 *                                                                                              MontiCAR Modeling Family, www.se-rwth.de
 *                                                                                              Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                                              All rights reserved.
 *
 *                                                                                              This project is free software; you can redistribute it and/or
 *                                                                                              modify it under the terms of the GNU Lesser General Public
 *                                                                                              License as published by the Free Software Foundation; either
 *                                                                                              version 3.0 of the License, or (at your option) any later version.
 *                                                                                              This library is distributed in the hope that it will be useful,
 *                                                                                              but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                                              MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                                              Lesser General Public License for more details.
 *
 *                                                                                              You should have received a copy of the GNU Lesser General Public
 *                                                                                              License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                                             *******************************************************************************
 *                                                                                         ====
 *
 *                                                                                         ******************************************************************************
 *                                                                                          MontiCAR Modeling Family, www.se-rwth.de
 *                                                                                          Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                                          All rights reserved.
 *
 *                                                                                          This project is free software; you can redistribute it and/or
 *                                                                                          modify it under the terms of the GNU Lesser General Public
 *                                                                                          License as published by the Free Software Foundation; either
 *                                                                                          version 3.0 of the License, or (at your option) any later version.
 *                                                                                          This library is distributed in the hope that it will be useful,
 *                                                                                          but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                                          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                                          Lesser General Public License for more details.
 *
 *                                                                                          You should have received a copy of the GNU Lesser General Public
 *                                                                                          License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                                         *******************************************************************************
 *                                                                                     ====
 *
 *                                                                                     ******************************************************************************
 *                                                                                      MontiCAR Modeling Family, www.se-rwth.de
 *                                                                                      Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                                      All rights reserved.
 *
 *                                                                                      This project is free software; you can redistribute it and/or
 *                                                                                      modify it under the terms of the GNU Lesser General Public
 *                                                                                      License as published by the Free Software Foundation; either
 *                                                                                      version 3.0 of the License, or (at your option) any later version.
 *                                                                                      This library is distributed in the hope that it will be useful,
 *                                                                                      but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                                      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                                      Lesser General Public License for more details.
 *
 *                                                                                      You should have received a copy of the GNU Lesser General Public
 *                                                                                      License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                                     *******************************************************************************
 *                                                                                 ====
 *
 *                                                                                 ******************************************************************************
 *                                                                                  MontiCAR Modeling Family, www.se-rwth.de
 *                                                                                  Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                                  All rights reserved.
 *
 *                                                                                  This project is free software; you can redistribute it and/or
 *                                                                                  modify it under the terms of the GNU Lesser General Public
 *                                                                                  License as published by the Free Software Foundation; either
 *                                                                                  version 3.0 of the License, or (at your option) any later version.
 *                                                                                  This library is distributed in the hope that it will be useful,
 *                                                                                  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                                  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                                  Lesser General Public License for more details.
 *
 *                                                                                  You should have received a copy of the GNU Lesser General Public
 *                                                                                  License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                                 *******************************************************************************
 *                                                                             ====
 *
 *                                                                             ******************************************************************************
 *                                                                              MontiCAR Modeling Family, www.se-rwth.de
 *                                                                              Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                              All rights reserved.
 *
 *                                                                              This project is free software; you can redistribute it and/or
 *                                                                              modify it under the terms of the GNU Lesser General Public
 *                                                                              License as published by the Free Software Foundation; either
 *                                                                              version 3.0 of the License, or (at your option) any later version.
 *                                                                              This library is distributed in the hope that it will be useful,
 *                                                                              but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                              MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                              Lesser General Public License for more details.
 *
 *                                                                              You should have received a copy of the GNU Lesser General Public
 *                                                                              License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                             *******************************************************************************
 *                                                                         ====
 *
 *                                                                         ******************************************************************************
 *                                                                          MontiCAR Modeling Family, www.se-rwth.de
 *                                                                          Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                          All rights reserved.
 *
 *                                                                          This project is free software; you can redistribute it and/or
 *                                                                          modify it under the terms of the GNU Lesser General Public
 *                                                                          License as published by the Free Software Foundation; either
 *                                                                          version 3.0 of the License, or (at your option) any later version.
 *                                                                          This library is distributed in the hope that it will be useful,
 *                                                                          but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                          Lesser General Public License for more details.
 *
 *                                                                          You should have received a copy of the GNU Lesser General Public
 *                                                                          License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                         *******************************************************************************
 *                                                                     ====
 *
 *                                                                     ******************************************************************************
 *                                                                      MontiCAR Modeling Family, www.se-rwth.de
 *                                                                      Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                      All rights reserved.
 *
 *                                                                      This project is free software; you can redistribute it and/or
 *                                                                      modify it under the terms of the GNU Lesser General Public
 *                                                                      License as published by the Free Software Foundation; either
 *                                                                      version 3.0 of the License, or (at your option) any later version.
 *                                                                      This library is distributed in the hope that it will be useful,
 *                                                                      but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                      Lesser General Public License for more details.
 *
 *                                                                      You should have received a copy of the GNU Lesser General Public
 *                                                                      License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                     *******************************************************************************
 *                                                                 ====
 *
 *                                                                 ******************************************************************************
 *                                                                  MontiCAR Modeling Family, www.se-rwth.de
 *                                                                  Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                                  All rights reserved.
 *
 *                                                                  This project is free software; you can redistribute it and/or
 *                                                                  modify it under the terms of the GNU Lesser General Public
 *                                                                  License as published by the Free Software Foundation; either
 *                                                                  version 3.0 of the License, or (at your option) any later version.
 *                                                                  This library is distributed in the hope that it will be useful,
 *                                                                  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                                  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                                  Lesser General Public License for more details.
 *
 *                                                                  You should have received a copy of the GNU Lesser General Public
 *                                                                  License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                                 *******************************************************************************
 *                                                             ====
 *
 *                                                             ******************************************************************************
 *                                                              MontiCAR Modeling Family, www.se-rwth.de
 *                                                              Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                              All rights reserved.
 *
 *                                                              This project is free software; you can redistribute it and/or
 *                                                              modify it under the terms of the GNU Lesser General Public
 *                                                              License as published by the Free Software Foundation; either
 *                                                              version 3.0 of the License, or (at your option) any later version.
 *                                                              This library is distributed in the hope that it will be useful,
 *                                                              but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                              MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                              Lesser General Public License for more details.
 *
 *                                                              You should have received a copy of the GNU Lesser General Public
 *                                                              License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                             *******************************************************************************
 *                                                         ====
 *
 *                                                         ******************************************************************************
 *                                                          MontiCAR Modeling Family, www.se-rwth.de
 *                                                          Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                          All rights reserved.
 *
 *                                                          This project is free software; you can redistribute it and/or
 *                                                          modify it under the terms of the GNU Lesser General Public
 *                                                          License as published by the Free Software Foundation; either
 *                                                          version 3.0 of the License, or (at your option) any later version.
 *                                                          This library is distributed in the hope that it will be useful,
 *                                                          but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                          Lesser General Public License for more details.
 *
 *                                                          You should have received a copy of the GNU Lesser General Public
 *                                                          License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                         *******************************************************************************
 *                                                     ====
 *
 *                                                     ******************************************************************************
 *                                                      MontiCAR Modeling Family, www.se-rwth.de
 *                                                      Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                      All rights reserved.
 *
 *                                                      This project is free software; you can redistribute it and/or
 *                                                      modify it under the terms of the GNU Lesser General Public
 *                                                      License as published by the Free Software Foundation; either
 *                                                      version 3.0 of the License, or (at your option) any later version.
 *                                                      This library is distributed in the hope that it will be useful,
 *                                                      but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                      Lesser General Public License for more details.
 *
 *                                                      You should have received a copy of the GNU Lesser General Public
 *                                                      License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                     *******************************************************************************
 *                                                 ====
 *
 *                                                 ******************************************************************************
 *                                                  MontiCAR Modeling Family, www.se-rwth.de
 *                                                  Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                                  All rights reserved.
 *
 *                                                  This project is free software; you can redistribute it and/or
 *                                                  modify it under the terms of the GNU Lesser General Public
 *                                                  License as published by the Free Software Foundation; either
 *                                                  version 3.0 of the License, or (at your option) any later version.
 *                                                  This library is distributed in the hope that it will be useful,
 *                                                  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                                  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                                  Lesser General Public License for more details.
 *
 *                                                  You should have received a copy of the GNU Lesser General Public
 *                                                  License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                                 *******************************************************************************
 *                                             ====
 *
 *                                             ******************************************************************************
 *                                              MontiCAR Modeling Family, www.se-rwth.de
 *                                              Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                              All rights reserved.
 *
 *                                              This project is free software; you can redistribute it and/or
 *                                              modify it under the terms of the GNU Lesser General Public
 *                                              License as published by the Free Software Foundation; either
 *                                              version 3.0 of the License, or (at your option) any later version.
 *                                              This library is distributed in the hope that it will be useful,
 *                                              but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                              MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                              Lesser General Public License for more details.
 *
 *                                              You should have received a copy of the GNU Lesser General Public
 *                                              License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                             *******************************************************************************
 *                                         ====
 *
 *                                         ******************************************************************************
 *                                          MontiCAR Modeling Family, www.se-rwth.de
 *                                          Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                          All rights reserved.
 *
 *                                          This project is free software; you can redistribute it and/or
 *                                          modify it under the terms of the GNU Lesser General Public
 *                                          License as published by the Free Software Foundation; either
 *                                          version 3.0 of the License, or (at your option) any later version.
 *                                          This library is distributed in the hope that it will be useful,
 *                                          but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                          Lesser General Public License for more details.
 *
 *                                          You should have received a copy of the GNU Lesser General Public
 *                                          License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                         *******************************************************************************
 *                                     ====
 *
 *                                     ******************************************************************************
 *                                      MontiCAR Modeling Family, www.se-rwth.de
 *                                      Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                      All rights reserved.
 *
 *                                      This project is free software; you can redistribute it and/or
 *                                      modify it under the terms of the GNU Lesser General Public
 *                                      License as published by the Free Software Foundation; either
 *                                      version 3.0 of the License, or (at your option) any later version.
 *                                      This library is distributed in the hope that it will be useful,
 *                                      but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                      Lesser General Public License for more details.
 *
 *                                      You should have received a copy of the GNU Lesser General Public
 *                                      License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                     *******************************************************************************
 *                                 ====
 *
 *                                 ******************************************************************************
 *                                  MontiCAR Modeling Family, www.se-rwth.de
 *                                  Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                                  All rights reserved.
 *
 *                                  This project is free software; you can redistribute it and/or
 *                                  modify it under the terms of the GNU Lesser General Public
 *                                  License as published by the Free Software Foundation; either
 *                                  version 3.0 of the License, or (at your option) any later version.
 *                                  This library is distributed in the hope that it will be useful,
 *                                  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                                  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                                  Lesser General Public License for more details.
 *
 *                                  You should have received a copy of the GNU Lesser General Public
 *                                  License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                                 *******************************************************************************
 *                             ====
 *
 *                             ******************************************************************************
 *                              MontiCAR Modeling Family, www.se-rwth.de
 *                              Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                              All rights reserved.
 *
 *                              This project is free software; you can redistribute it and/or
 *                              modify it under the terms of the GNU Lesser General Public
 *                              License as published by the Free Software Foundation; either
 *                              version 3.0 of the License, or (at your option) any later version.
 *                              This library is distributed in the hope that it will be useful,
 *                              but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                              MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                              Lesser General Public License for more details.
 *
 *                              You should have received a copy of the GNU Lesser General Public
 *                              License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                             *******************************************************************************
 *                         ====
 *
 *                         ******************************************************************************
 *                          MontiCAR Modeling Family, www.se-rwth.de
 *                          Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                          All rights reserved.
 *
 *                          This project is free software; you can redistribute it and/or
 *                          modify it under the terms of the GNU Lesser General Public
 *                          License as published by the Free Software Foundation; either
 *                          version 3.0 of the License, or (at your option) any later version.
 *                          This library is distributed in the hope that it will be useful,
 *                          but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                          Lesser General Public License for more details.
 *
 *                          You should have received a copy of the GNU Lesser General Public
 *                          License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                         *******************************************************************************
 *                     ====
 *
 *                     ******************************************************************************
 *                      MontiCAR Modeling Family, www.se-rwth.de
 *                      Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                      All rights reserved.
 *
 *                      This project is free software; you can redistribute it and/or
 *                      modify it under the terms of the GNU Lesser General Public
 *                      License as published by the Free Software Foundation; either
 *                      version 3.0 of the License, or (at your option) any later version.
 *                      This library is distributed in the hope that it will be useful,
 *                      but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                      Lesser General Public License for more details.
 *
 *                      You should have received a copy of the GNU Lesser General Public
 *                      License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                     *******************************************************************************
 *                 ====
 *
 *                 ******************************************************************************
 *                  MontiCAR Modeling Family, www.se-rwth.de
 *                  Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *                  All rights reserved.
 *
 *                  This project is free software; you can redistribute it and/or
 *                  modify it under the terms of the GNU Lesser General Public
 *                  License as published by the Free Software Foundation; either
 *                  version 3.0 of the License, or (at your option) any later version.
 *                  This library is distributed in the hope that it will be useful,
 *                  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *                  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *                  Lesser General Public License for more details.
 *
 *                  You should have received a copy of the GNU Lesser General Public
 *                  License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *                 *******************************************************************************
 *             ====
 *
 *             ******************************************************************************
 *              MontiCAR Modeling Family, www.se-rwth.de
 *              Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *              All rights reserved.
 *
 *              This project is free software; you can redistribute it and/or
 *              modify it under the terms of the GNU Lesser General Public
 *              License as published by the Free Software Foundation; either
 *              version 3.0 of the License, or (at your option) any later version.
 *              This library is distributed in the hope that it will be useful,
 *              but WITHOUT ANY WARRANTY; without even the implied warranty of
 *              MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *              Lesser General Public License for more details.
 *
 *              You should have received a copy of the GNU Lesser General Public
 *              License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *             *******************************************************************************
 *         ====
 *
 *         ******************************************************************************
 *          MontiCAR Modeling Family, www.se-rwth.de
 *          Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *          All rights reserved.
 *
 *          This project is free software; you can redistribute it and/or
 *          modify it under the terms of the GNU Lesser General Public
 *          License as published by the Free Software Foundation; either
 *          version 3.0 of the License, or (at your option) any later version.
 *          This library is distributed in the hope that it will be useful,
 *          but WITHOUT ANY WARRANTY; without even the implied warranty of
 *          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *          Lesser General Public License for more details.
 *
 *          You should have received a copy of the GNU Lesser General Public
 *          License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *         *******************************************************************************
 *     ====
 *
 *     ******************************************************************************
 *      MontiCAR Modeling Family, www.se-rwth.de
 *      Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *      All rights reserved.
 *
 *      This project is free software; you can redistribute it and/or
 *      modify it under the terms of the GNU Lesser General Public
 *      License as published by the Free Software Foundation; either
 *      version 3.0 of the License, or (at your option) any later version.
 *      This library is distributed in the hope that it will be useful,
 *      but WITHOUT ANY WARRANTY; without even the implied warranty of
 *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *      Lesser General Public License for more details.
 *
 *      You should have received a copy of the GNU Lesser General Public
 *      License along with this project. If not, see <http://www.gnu.org/licenses/>.
 *     *******************************************************************************
 * ====
 *
 * ******************************************************************************
 *  MontiCAR Modeling Family, www.se-rwth.de
 *  Copyright (c) 2017, Software Engineering Group at RWTH Aachen,
 *  All rights reserved.
 *
 *  This project is free software; you can redistribute it and/or
 *  modify it under the terms of the GNU Lesser General Public
 *  License as published by the Free Software Foundation; either
 *  version 3.0 of the License, or (at your option) any later version.
 *  This library is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *  Lesser General Public License for more details.
 *
 *  You should have received a copy of the GNU Lesser General Public
 *  License along with this project. If not, see <http://www.gnu.org/licenses/>.
 * *******************************************************************************
 */
package simulation.vehicle;

import org.apache.commons.math3.geometry.euclidean.threed.RotationConvention;
import org.apache.commons.math3.geometry.euclidean.threed.RotationOrder;
import org.apache.commons.math3.geometry.euclidean.threed.Rotation;
import org.apache.commons.math3.geometry.euclidean.threed.Vector3D;
import org.apache.commons.math3.linear.ArrayRealVector;
import org.apache.commons.math3.linear.BlockRealMatrix;
import org.apache.commons.math3.linear.RealMatrix;
import org.apache.commons.math3.linear.RealVector;
import org.jfree.chart.block.BlockContainer;
import org.junit.*;
import simulation.util.Log;
import simulation.util.MathHelper;

import static org.junit.Assert.*;

/**
 * Class that tests the MassPoint class
 */
public class MassPointTest {

    private MassPoint mp = null;

    @BeforeClass
    public static void setUpClass() {
        Log.setLogEnabled(false);
    }

    @AfterClass
    public static void tearDownClass() {
        Log.setLogEnabled(true);
    }

    @Before
    public void setUp() {
        RealVector localPos = new ArrayRealVector(new double[] {0.2346, 0.3678, 0.2486});
        RealVector localCenterDiff = new ArrayRealVector(new double[] {5.2346, 0.678, 1.2486});
        RealVector pos = new ArrayRealVector(new double[] {249.2346, 10.3678, 3.2486});
        RealVector centerDiff = new ArrayRealVector(new double[] {240.2346, 11.3678, 2.2486});
        RealVector velocity = new ArrayRealVector(new double[] {0.0, 50.3, -0.25});
        RealVector force = new ArrayRealVector(new double[] {5.02, 0.1, -39.4});
        double mass = 500.0;
        mp = new MassPoint(MassPointType.MASS_POINT_TYPE_UNKNOWN, localPos, localCenterDiff, pos, centerDiff, velocity, force, mass);
    }

    @Test
    public void testGetterAndSetter() {

        //Temporary rotation screwing around
        /*
        Rotation rotx = new Rotation(RotationOrder.XYZ, RotationConvention.VECTOR_OPERATOR, Math.PI / 4, 0.0, 0.0);
        RealMatrix rotationx = new BlockRealMatrix(rotx.getMatrix());
        Rotation roty = new Rotation(RotationOrder.XYZ, RotationConvention.VECTOR_OPERATOR, 0.0, Math.PI / 4, 0.0);
        RealMatrix rotationy = new BlockRealMatrix(roty.getMatrix());
        Rotation rotxy = new Rotation(RotationOrder.XYZ, RotationConvention.VECTOR_OPERATOR, Math.PI / 4, Math.PI / 4, 0.0);
        RealMatrix rotationxy = new BlockRealMatrix(rotxy.getMatrix());
        System.out.println(rotationx);
        System.out.println(rotationy);
        System.out.println(rotationxy);
        System.out.println(rotationx.multiply(rotationy));
        RealVector xVector = new ArrayRealVector(new double[]{1.0, 0.0, 0.0});
        RealVector yVector = new ArrayRealVector(new double[]{0.0, 1.0, 0.0});
        RealVector zVector = new ArrayRealVector(new double[]{0.0, 0.0, 1.0});
        System.out.println(xVector);
        System.out.println(rotationx.operate(xVector));
        System.out.println(rotationy.operate(xVector));
        System.out.println(rotationxy.operate(xVector));
        System.out.println(yVector);
        System.out.println(rotationx.operate(yVector));
        System.out.println(zVector);
        System.out.println(rotationx.operate(zVector));
        System.out.println("");


        RealVector gravity = new ArrayRealVector(new double[]{0.0, 0.0, -1.0});
        System.out.println(gravity);
        double slope = 0.5;
        double bank = 0.5;

        Rotation bankRotation = new Rotation(RotationOrder.XYZ, RotationConvention.FRAME_TRANSFORM, bank, 0.0, 0.0);
        RealMatrix bankMatrix = new BlockRealMatrix(bankRotation.getMatrix());
        Rotation slopeRotation = new Rotation(RotationOrder.XYZ, RotationConvention.FRAME_TRANSFORM, 0.0, - slope, 0.0);
        RealMatrix slopeMatrix = new BlockRealMatrix(slopeRotation.getMatrix());
        Rotation slopeBankRotation = new Rotation(RotationOrder.XYZ, RotationConvention.FRAME_TRANSFORM, bank, - slope, 0.0);
        RealMatrix fromGlobalToLocal = new BlockRealMatrix(slopeBankRotation.getMatrix());
        System.out.println(slopeMatrix.multiply(bankMatrix).operate(gravity));
        System.out.println(fromGlobalToLocal.operate(gravity));
        System.out.println(gravity.getEntry(2) * Math.sin(slope));
        System.out.println(-gravity.getEntry(2)* Math.sin(-bank));
        */

        /*
        Rotation slopeBankRotationInverse = new Rotation(RotationOrder.ZYX, RotationConvention.FRAME_TRANSFORM, 0.0, slope, - bank);
        RealMatrix fromLocalToGlobal = new BlockRealMatrix(slopeBankRotationInverse.getMatrix());
        System.out.println(fromLocalToGlobal.operate(fromGlobalToLocal.operate(gravity)));

        Rotation one = new Rotation(RotationOrder.XYZ, RotationConvention.VECTOR_OPERATOR, 0.1, 0.0, 0.0);
        RealMatrix oneMatrix = new BlockRealMatrix(one.getMatrix());
        Rotation two = new Rotation(RotationOrder.XYZ, RotationConvention.VECTOR_OPERATOR, 0.1, 0.0, 0.0);
        RealMatrix twoMatrix = new BlockRealMatrix(two.getMatrix());
        Rotation three = new Rotation(RotationOrder.XYZ, RotationConvention.VECTOR_OPERATOR, 0.2, 0.0, 0.0);
        RealMatrix threeMatrix = new BlockRealMatrix(three.getMatrix());
        System.out.println(oneMatrix.multiply(twoMatrix));
        System.out.println(twoMatrix.multiply(oneMatrix));
        System.out.println(threeMatrix);
        */


        /*
        RealVector xyCross = new ArrayRealVector(new double[]{0.0, 0.0, 0.0});
        try{
            xyCross = MathHelper.vector3DCrossProduct(xVector, yVector);
        }catch(Exception e){
            e.printStackTrace();
        }
        System.out.println(xyCross);
        */

        //Desired x,y position and z rotation
        double posX = 0.0;
        double posY = 0.0;
        //double rotZ = Math.PI / 2;
        double rotZ = 0;

        //Current modelica values
        double z = 0.3;
        double L1 = 1.0;
        double L2 = 1.0;
        double TW_f = 1.0;
        double TW_r = 1.0;

        //set on ground only rotated around z axis
        double ground = getGround(posX, posY);
        double posZ = ground + z;
        RealVector position = new ArrayRealVector(new double[]{posX, posY, posZ});

        //rotate around z axis
        Rotation rot = new Rotation(RotationOrder.XYZ, RotationConvention.VECTOR_OPERATOR, 0.0, 0.0, rotZ);
        RealMatrix rotation = new BlockRealMatrix(rot.getMatrix());

        /*

        //Get local wheel positions
        RealVector frontLeftPositionLocal = new ArrayRealVector(new double[]{L1, TW_f / 2, -z});
        RealVector frontRightPositionLocal = new ArrayRealVector(new double[]{L1, -TW_f / 2, -z});
        RealVector backLeftPositionLocal = new ArrayRealVector(new double[]{-L2, TW_r / 2, -z});
        RealVector backRightPositionLocal = new ArrayRealVector(new double[]{-L2, -TW_r / 2, -z});

        //Get global wheel positions only rotated around z axis
        RealVector frontLeftPosition = rotation.operate(frontLeftPositionLocal);
        RealVector frontRightPosition = rotation.operate(frontRightPositionLocal);
        RealVector backLeftPosition = rotation.operate(backLeftPositionLocal);
        RealVector backRightPosition = rotation.operate(backRightPositionLocal);

        //Get ground values for rotated wheel positions
        double frontLeftGround = getGround(frontLeftPosition.getEntry(0), frontLeftPosition.getEntry(1));
        double frontRightGround = getGround(frontRightPosition.getEntry(0), frontRightPosition.getEntry(1));
        double backLeftGround = getGround(backLeftPosition.getEntry(0), backLeftPosition.getEntry(1));
        double backRightGround = getGround(backRightPosition.getEntry(0), backRightPosition.getEntry(1));

        //Store new ground value in global wheel position
        frontLeftPosition.setEntry(2, frontLeftGround);
        frontRightPosition.setEntry(2, frontRightGround);
        backLeftPosition.setEntry(2, backLeftGround);
        backRightPosition.setEntry(2, backRightGround);

        //Compute relative vectors
        Vector3D rightToLeftFrontSide = realTo3D(frontLeftPosition.subtract(frontRightPosition));
        Vector3D rightToLeftBackSide = realTo3D(backLeftPosition.subtract(backRightPosition));
        Vector3D backToFrontLeftSide = realTo3D(frontLeftPosition.subtract(backLeftPosition));
        Vector3D backToFrontRightSide = realTo3D(frontRightPosition.subtract(backRightPosition));

        //Compute angles between relative vectors and X-Y-Plane
        Vector3D XYNorm = new Vector3D(0.0, 0.0, 1.0);
        double rightToLeftFrontSideAngle = (Math.PI / 2) - Vector3D.angle(XYNorm, rightToLeftFrontSide);
        double rightToLeftBackSideAngle = (Math.PI / 2) - Vector3D.angle(XYNorm, rightToLeftBackSide);
        double backToFrontLeftSideAngle = (Math.PI / 2) - Vector3D.angle(XYNorm, backToFrontLeftSide);
        double backToFrontRightSideAngle = (Math.PI / 2) - Vector3D.angle(XYNorm, backToFrontRightSide);

        //Get average angles
        double bank = (rightToLeftFrontSideAngle + rightToLeftBackSideAngle)*0.5;
        double slope = (backToFrontLeftSideAngle + backToFrontRightSideAngle)*0.5;
        */

        //Get local positions
        RealVector frontPositionLocal = new ArrayRealVector(new double[]{L1, 0.0, -z});
        RealVector backPositionLocal = new ArrayRealVector(new double[]{-L2, 0.0, -z});
        RealVector leftPositionLocal = new ArrayRealVector(new double[]{0.0, (TW_f / 2 + TW_r / 2) / 2, -z});
        RealVector rightPositionLocal = new ArrayRealVector(new double[]{0.0, -(TW_f / 2 + TW_r / 2) / 2, -z});

        Vector3D backToFrontLocal = new Vector3D(L1 + L2, 0.0, 0.0);

        //Get global positions only rotated around z axis
        RealVector frontPosition = position.add(rotation.operate(frontPositionLocal));
        RealVector backPosition = position.add(rotation.operate(backPositionLocal));
        RealVector leftPosition = position.add(rotation.operate(leftPositionLocal));
        RealVector rightPosition = position.add(rotation.operate(rightPositionLocal));

        System.out.println(frontPosition);
        System.out.println(backPosition);
        System.out.println(leftPosition);
        System.out.println(rightPosition);

        //Get ground values for rotated wheel positions
        double frontGround = getGround(frontPosition.getEntry(0), frontPosition.getEntry(1));
        double backGround = getGround(backPosition.getEntry(0), backPosition.getEntry(1));
        double leftGround = getGround(leftPosition.getEntry(0), leftPosition.getEntry(1));
        double rightGround = getGround(rightPosition.getEntry(0), rightPosition.getEntry(1));

        //Store new ground value in global wheel position
        frontPosition.setEntry(2, frontGround);
        backPosition.setEntry(2, backGround);
        leftPosition.setEntry(2, leftGround);
        rightPosition.setEntry(2, rightGround);

        System.out.println(frontPosition);
        System.out.println(backPosition);
        System.out.println(leftPosition);
        System.out.println(rightPosition);

        //Compute relative vectors
        Vector3D backToFront = realTo3D(frontPosition.subtract(backPosition));
        Vector3D rightToLeft = realTo3D(leftPosition.subtract(rightPosition));
        Vector3D roadPlaneNorm = Vector3D.crossProduct(backToFront, rightToLeft);

        System.out.println(backToFront);
        System.out.println(rightToLeft);
        System.out.println(roadPlaneNorm);

        //Compute angles between relative vectors and X-Y-Plane
        Vector3D XYPlaneNorm = new Vector3D(0.0, 0.0, 1.0);
        double backToFrontAngle = (Math.PI / 2) - Vector3D.angle(XYPlaneNorm, backToFront);
        double rightToLeftAngle = (Math.PI / 2) - Vector3D.angle(XYPlaneNorm, rightToLeft);

        double slope = backToFrontAngle;
        double bank = rightToLeftAngle;

        System.out.println(bank);
        System.out.println(slope);

        Rotation finalRotOld = new Rotation(RotationOrder.XYZ, RotationConvention.VECTOR_OPERATOR, slope, bank, rotZ);
        RealMatrix finalRotationOld = new BlockRealMatrix(rot.getMatrix());

        System.out.println(finalRotationOld);

        //The resulting rotation should transform the XY plane norm to the roadPlaneNorm
        //and the backToFrontLocal to the BackToFront

        System.out.println(XYPlaneNorm);
        System.out.println(backToFrontLocal);
        System.out.println(roadPlaneNorm);
        System.out.println(backToFront);

        Rotation finalRot = new Rotation(XYPlaneNorm, backToFrontLocal, roadPlaneNorm, backToFront);
        RealMatrix finalRotation = new BlockRealMatrix(finalRot.getMatrix());

        System.out.println(finalRotation);

        //ToDo adjust position so that the rotation done by placing the car on the surface was done around the center of the road plane
        RealVector roadPlaneCenter = position.add(new ArrayRealVector(new double[]{0.0, 0.0, -z}));
        RealVector roadPlaneCenterToPositionLocal = new ArrayRealVector(new double[]{0.0, 0.0, z});
        RealVector finalPosition = roadPlaneCenter.add(finalRotation.operate(roadPlaneCenterToPositionLocal));

        System.out.println(finalPosition);

        //modelica output
        double v_x = 1.0;

        //express outputs as vectors
        RealVector velocityLocal = new ArrayRealVector(new double[]{v_x, 0.0, 0.0});
        System.out.println(velocityLocal);

        //express output in global position
        //RealVector velocity = finalRotation.operate(velocityLocal);
        //System.out.println(velocity);






        RealVector localPos = new ArrayRealVector(new double[] {0.2346, 0.3678, 0.2486});
        RealVector localCenterDiff = new ArrayRealVector(new double[] {5.2346, 0.678, 1.2486});
        RealVector pos = new ArrayRealVector(new double[] {249.2346, 10.3678, 3.2486});
        RealVector centerDiff = new ArrayRealVector(new double[] {240.2346, 11.3678, 2.2486});
        RealVector velocity = new ArrayRealVector(new double[] {0.0, 50.3, -0.25});
        RealVector force = new ArrayRealVector(new double[] {5.02, 0.1, -39.4});
        double mass = 500.0;

        // Ensure that constructor works
        assertTrue(MathHelper.vectorEquals(mp.getLocalPos(), localPos, 0.00000001));
        assertTrue(MathHelper.vectorEquals(mp.getLocalCenterDiff(), localCenterDiff, 0.00000001));
        assertTrue(MathHelper.vectorEquals(mp.getPos(), pos, 0.00000001));
        assertTrue(MathHelper.vectorEquals(mp.getCenterDiff(), centerDiff, 0.00000001));
        assertTrue(MathHelper.vectorEquals(mp.getVelocity(), velocity, 0.00000001));
        assertTrue(MathHelper.vectorEquals(mp.getForce(), force, 0.00000001));
        assertTrue(mp.getMass() == mass);

        // Modify local copies of vectors, mass point values should not change!
        localPos.setEntry(0, 0.3256);
        localCenterDiff.setEntry(0, 0.3256);
        pos.setEntry(0, 0.3256);
        centerDiff.setEntry(0, 0.3256);
        velocity.setEntry(0, 0.3256);
        force.setEntry(0, 0.3256);

        // Now the vectors should not be the same anymore
        assertFalse(MathHelper.vectorEquals(mp.getLocalPos(), localPos, 0.00000001));
        assertFalse(MathHelper.vectorEquals(mp.getLocalCenterDiff(), localCenterDiff, 0.00000001));
        assertFalse(MathHelper.vectorEquals(mp.getPos(), pos, 0.00000001));
        assertFalse(MathHelper.vectorEquals(mp.getCenterDiff(), centerDiff, 0.00000001));
        assertFalse(MathHelper.vectorEquals(mp.getVelocity(), velocity, 0.00000001));
        assertFalse(MathHelper.vectorEquals(mp.getForce(), force, 0.00000001));

        // Use setter to modify data
        mp.setLocalPos(localPos);
        mp.setLocalCenterDiff(localCenterDiff);
        mp.setPos(pos);
        mp.setCenterDiff(centerDiff);
        mp.setVelocity(velocity);
        mp.setForce(force);
        mp.setMass(600.0);

        // Ensure that setter work
        assertTrue(MathHelper.vectorEquals(mp.getLocalPos(), localPos, 0.00000001));
        assertTrue(MathHelper.vectorEquals(mp.getLocalCenterDiff(), localCenterDiff, 0.00000001));
        assertTrue(MathHelper.vectorEquals(mp.getPos(), pos, 0.00000001));
        assertTrue(MathHelper.vectorEquals(mp.getCenterDiff(), centerDiff, 0.00000001));
        assertTrue(MathHelper.vectorEquals(mp.getVelocity(), velocity, 0.00000001));
        assertTrue(MathHelper.vectorEquals(mp.getForce(), force, 0.00000001));
        assertTrue(mp.getMass() == 600.0);
    }

    private double getGround(double x, double y){
        return x;
    }

    private Vector3D realTo3D(RealVector vector){
        return new Vector3D(vector.getEntry(0), vector.getEntry(1), vector.getEntry(2));
    }
}