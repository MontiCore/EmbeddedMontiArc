package de.rwth.armin.modeling.autopilot.behavior;

component DriveToFirstPosition {
    port
        in  B                                   isDriveToFirstPosition,
        in  Q (-oo m : 0.01 m : oo m) ^ 2       currentPosition,

        in Z (0 : 10)                           trimmedTrajectoryLength,
        in Q (-oo m : 0.01 m : oo m) ^ 10       trimmedTrajectoryX,
        in Q (-oo m : 0.01 m : oo m) ^ 10       trimmedTrajectoryY,

        out Q (-oo m : 0.01 m : oo m) ^ 2       desiredDirection,
        out Q (-oo m : 0.01 m : oo m)           signedDistanceToTrajectory,
        out Q (0.0 m/s : 0.01 m/s : 13.0 m/s)   minVelocity,
        out Q (0.0 m/s : 0.01 m/s : 13.0 m/s)   maxVelocity,
        out Q (0.0 m/s : 0.01 m/s : 13.0 m/s)   distance;

    implementation Math {
        desiredDirection(1) = 0.0;
        desiredDirection(2) = 0.0;
        signedDistanceToTrajectory = 0.0;
        minVelocity = 0.0;
        maxVelocity = 0.0;
        distance = 0.0;
        if (isDriveToFirstPosition) && (trimmedTrajectoryLength >= 1)
        maxVelocity = 7.0;
        desiredDirection(1) = trimmedTrajectoryX(1) - currentPosition(1);
        desiredDirection(2) = trimmedTrajectoryY(1) - currentPosition(2);
        Q sqr_dist = desiredDirection(1) * desiredDirection(1) + desiredDirection(2) * desiredDirection(2);
        distance = sqrt( sqr_dist );
        if (trimmedTrajectoryLength >= 2)
            minVelocity = 3.0;
        end
        end
    }
}
